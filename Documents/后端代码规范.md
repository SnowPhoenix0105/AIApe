# 后端开发代码规范

## 序

为了保证后端代码的一致性，提高可维护性、可移植性，我们做出代码规范约定。

总的来说，与标准库的样式保持相对一致，并遵守.NET开发常用约定。

## 命名

1. 类名、接口名、代理类型名等表示类型的名称，一律采用大驼峰命名法；
2. 方法名、属性名（包括自动属性），一律采用大驼峰命名法；
3. 字段名、局部变量名、函数形参名，一律采用小驼峰命名法；
4. 命名空间采用大驼峰命名法；
```C#
namespace MyNamespace // 命名空间名
{
    public class MyClass // 类名
    {
        private int userId; // 字段名

        public int UserId { get => userId; } // 属性名

        public int Age { get; set; } // 自动属性名

        public delegate void MyFunctionType(int age); // 代理类型名

        public void Foo(MyFunctionType func)  // 方法名、参数名
        {
            int age = Age; // 局部变量名
            func(age);
        }
    }
}
```
5. 异步方法，即函数签名包含`async`的方法，以`Async`作为后缀，运行一个`Task<>`并直接将其返回的方法也应以`Async`作为后缀；
``` C#
public async Task<int> FooAsync() // 异步方法
{
    int res = await BarAsync();
    return res + 1;
}

public Task<int> BarAsync() // 直接返回Task的方法
{
    return Task.Run(() => { return 1; });
}
```

## 格式

1. 大括号使用。要么左右括号都在同一行，要么左右括号都在同一列，并且左右括号同列时左括号所在行只有大括号，只有本文档提到的特殊情况右括号所在行可以有其它内容。即如果大括号中的内容较少，可以在同一行内写下，那么大括号的左右括号不换行，否则，新起一行，以左括号作为该行的唯一非空内容；
```C#
public Task<int> BarAsync()
{
    return Task.Run(() => { return 1; });
}
```
2. 二元运算符与变量之间需要空格，一元运算符与变量之前不能有空格，不可以嵌套使用三目运算符，`=>`符号前后都需要空格。注意赋值符号也是二元运算符；
3. for循环，分号前无空格，分号后有空格，`for`关键字后有空格，大括号新起一行；
```C#
for (int i = 0; i < 1024; i++)
{
    DoSomething();
}
```
4. foreach循环，`foreach`关键字后有空格，大括号新起一行，元素变量尽量使用`var`声明；
```C#
foreach (var elem in collection)
{
    DoSomething(elem);
}
```
5. do-while循环，`do`关键字后后大括号新起一行，右大括号与`while`关键字同行，并以空格相隔；
```C#
int n = 0;
do
{
    DoSomething(n);
    n++;
} while(n < 5);
```
1. try-catch-finally，`try`、`finally`关键字都作为该行唯一内容，其后的大括号新起一行，`catch`后有一个空格；
```C#
try
{
    FunctionMayThrowException();
}
catch (MyException e)
{
    Log(e);
}
finally
{
    CleanUp();
}
```
7. lambda表达式，在参数列表只有一个参数时，不要小括号，简单表达式不需要大括号；
```C#
Foo(i => i + 1);
```
8. 其余参考[C# 语言参考 - 语句关键字](https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/keywords/statement-keywords)中的实例的格式；

## 注释

1. 为避免编码错误，尽量不要使用中文；
2. 为了方便智能提示，调用方可以在编写时查看注释，所有公开方法、属性、类等，都应当配有VisualStudio提供的XML格式注释，参考[XML 文档注释（C# 编程指南）](https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/xmldoc/)；
```C#
/// <summary>
///  This class performs an important function.
/// </summary>
public class MyClass {}
```

## 编程偏好

1. 如果需要持有的资源实现了`IDispose`接口，请尽量使用[using语句](https://docs.microsoft.com/zh-cn/dotnet/csharp/language-reference/keywords/using-statement)；
2. 为了保证效率，且避免混用`Wait()`和`await`造成的死锁，尽量使用异步的方式，而不要使用阻塞式编程。即面对`Task`对象，尽量使用`await`关键字，而不要使用可能造成阻塞的`Wait()`方法，或者访问可能造成阻塞的`Result`属性；
3. 除非产生了大量GC压力，不要定义和创建作为值类型的结构体；
4. 不要将不必要的类设置为public，以避免IDE的智能提示混杂过多无用信息；
5. POCO对象（简单CLR对象，几乎没有方法，主要作为数据的载体），除非必要（如readonly字段、无对应的公开属性、基类没有无参构造函数等），只提供无参构造函数，各个属性通过[对象初始值设定项](https://docs.microsoft.com/zh-cn/dotnet/csharp/programming-guide/classes-and-structs/how-to-initialize-objects-by-using-an-object-initializer)方式进行初始化；
6. 为避免值类型的装箱拆箱，尽量不要以`object`作为函数参数，如有需要，应当以泛型的方式来实现；
7. 尽量使用内插字符串，而不要用`+`连接字符串或使用`Format`，以提高可读性，除非后者更易读；





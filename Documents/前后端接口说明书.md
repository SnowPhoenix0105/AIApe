# 前后端接口说明书


## 序

为保证安全性，所有接口请使用https访问，将考虑禁用所有http访问。

权限分为三种：`游客`、`用户`、`管理员`，权限等级依次提高，权限较高的用户可以进行全校较低的用户的操作。其中`用户`以上的权限需要登录获得，在请求相关方式时，请求头中需包含`Authorization`项，值为`Bearer {token}`，其中`token`为登录成功后服务器返回的[RFC7519 - JWT](https://tools.ietf.org/html/rfc7519#section-4)，使用参考[JWT](https://jwt.io/introduction)。

约定API描述中，用一对大括号`{`、`}`包裹的内容为当前位置参数的描述，特别地，`{BASE_URL}`表示域名。被一对`[`、`]`包裹的内容标识可选的内容。

例如以下描述：

```
{BASE_URL}/api/question?qid={qid}
```
实际使用时，将转换为：
```
https://aiape.icu/api/question?qid=1024
```

索引(并且为了方便，将省略`{BASE_URL}`)：

|URL|类型|功能简介|
|:-|:-|:-|
|[/api/message](#机器人消息 /api/message)|`POST`|与机器人进行交互，具体接口参见[Bot Framework REST API](https://docs.microsoft.com/zh-cn/azure/bot-service/rest-api/bot-framework-rest-overview?view=azure-bot-service-4.0)|
||||
||||





## 机器人消息 /api/message

* 权限：`用户`
* 格式：
```
{BASE_URL}/api/message
```
* 类型： POST
* 简介：与机器人进行交互，具体接口参见[Bot Framework REST API](https://docs.microsoft.com/zh-cn/azure/bot-service/rest-api/bot-framework-rest-overview?view=azure-bot-service-4.0)
* 权限不足时，返回401。





# 用户相关

## 注册用户 /api/user/signup

* 权限：`游客`
* 格式：
```
{BASE_URL}/api/user/signup
```
* 类型：POST
* 请求体：
```JSON
{
    "name" : "昵称",
    "email" : "sample@buaa.edu.cn",
    "password" : "09azAZ@$!%*#_~?&^"
}
```
* 请求体各参数含义：
  * `name`：昵称，字符串。字符数量为2~18，支持汉字、大小写字母、数字。不可与其他用户重复；
  * `email`：邮箱地址，字符串。仅允许ASCII中可打印字符的合法的邮箱地址，根据[RFC5321 - SMTP](https://www.rfc-editor.org/rfc/rfc5321.txt)标准第`4.5.3.1.1.`条至`4.5.3.1.3.`条，用户名（`@`前）长度不超过64字节，总长度不超过254字节；
  * `password`：密码，字符串。仅允许大小写字母、数字、`@$!%*#_~?&^`，长度为8~16。明文传输，请务必确保以https发送；
* 响应体：
```JSON
{
    "status" : "success",
    "message" : "signup success"
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * `message`：信息，作为`status`的扩充信息，更易于阅读；
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功注册|
|`nameInvalid`|`200 OK`|昵称格式不合法|
|`nameExisted`|`200 OK`|昵称已经存在|
|`emailInvalid`|`200 OK`|邮件地址格式不合法|
|`emailExisted`|`200 OK`|邮件地址已经存在|
|`passwordInvalid`|`200 OK`|密码格式不合法|





## 登录 /api/user/login

* 权限：`游客`
* 格式：
```
{BASE_URL}/api/user/login
```
* 类型：POST
* 请求体：
```JSON
{
    "email" : "sample@buaa.edu.cn",
    "password" : "09azAZ@$!%*#_~?&^"
}
```
* 请求体各参数含义：
  * `email`： 邮箱，字符串。将不会检查格式合法性，但是会检查是否已注册。
  * `password`：密码，字符串。同样不会检查格式合法性，但是会检查是否与email对应。
* 响应体：
```JSON
{
    "status" : "success",
    "message" : "login success",
    "token" : "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMTIzIiwiZXhwIjoxNjE5MDYwMTM4LCJpc3MiOiJ0ZXN0LmNuIiwiYXVkIjoidGVzdCJ9.aCI1lSQjO1flQXkrATE70Q8KhH2SYBeAPFDIyktFefI"
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * `message`：信息，作为`status`的扩充信息，更易于阅读。当用户邮箱或密码错误时，不应当提供更详细的信息；
  * `token`：[JSON Web Token](https://jwt.io/introduction)，作为用户信息的唯一标识；
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
|`fail`|`200 OK`|邮箱或密码错误|






## 获取用户公开信息 /api/user/publicinfo

* 权限：`用户`
* 格式：
```
{BASE_URL}/api/user/publicinfo[?uid={uid}]
```
* 类型：GET
* 简介：获取`uid`指定的用户的公开用户信息。当`uid`为-1或未提供`uid`参数时，将视为查询当前用户。
* 响应体：
```JSON
{
    "status" : "success",
    "uid" : 12345,
    "name" : "昵称",
    "email" : "example@buaa.edu.cn"
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * `uid`：用户ID，uint；
  * `name`：昵称，字符串。字符数量为2~18，支持汉字、大小写字母、数字。不可与其他用户重复；
  * `email`：邮箱地址，字符串，**若用户未公开邮箱，则为空字符串**。仅包含ASCII中可打印字符的合法的邮箱地址，用户名（`@`前）长度不超过64字节，总长度不超过254字节；
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
|`userNotExist`|`uid`对应的用户不存在|
||`401 Unauthorized`|权限不足|







## 获取用户详细信息 /api/user/fullinfo

* 权限：`用户`/`管理员`
* 格式：
```
{BASE_URL}/api/user/info[?uid={uid}]
```
* 类型：GET
* 简介：获取`uid`指定的用户的详细用户信息。当`uid`为-1或未提供`uid`参数时，将视为查询当前用户；当查询目标为当前用户时，只需要`用户`权限；当查询目标不是当前用户时，需要`管理员`权限。
* 响应体：
```JSON
{
    "status" : "success",
    "uid" : 12345,
    "name" : "昵称",
    "email" : "example@buaa.edu.cn",
    "auth" : 0
}
```
* `status`取值及其含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * `name`：昵称，字符串。字符数量为2~18，支持汉字、大小写字母、数字。不可与其他用户重复；
  * `email`：邮箱地址，字符串。仅包含ASCII中可打印字符的合法的邮箱地址，用户名（`@`前）长度不超过64字节，总长度不超过254字节；
  * `uid`：用户ID，uint；
  * `auth`：权限等级，int。`1`表示用户，`2`表示管理员；
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
|`userNotExist`|`uid`对应的用户不存在|
||`401 Unauthorized`|权限不足|






## 修改用户信息 /api/user/modify

* 权限：`用户`/`管理员`
* 格式：
```
{BASE_URL}/api/user/modify
```
* 类型：PUT
* 简介：修改用户的详细信息，要么全部成功，要么全部失败。
* 请求体：**所有项目均为可选项**
```JSON
{
    "uid" : 1234,
    "name" : "新昵称",
    "password" : "09azAZ@$!%*#_~?&^", 
    "auth" : 1
}
```
* 请求体各参数含义：
  * `uid`：待修改目标的ID，int。`uid`为负数或不存在时，表示当前用户；当修改当前用户时，只需要`用户`权限，当修改目标不是当前用户时，需要`管理员权限`；
  * `name`：新昵称，字符串，不包括此项表示不更改昵称。字符数量为2~18，支持汉字、大小写字母、数字。不可与其他用户重复；
  * `auth`：新权限等级，int，**只有管理员可以更改该字段**。`1`表示用户，`2`表示管理员。不可以修改当前用户的权限等级；
  * `password`：新密码，字符串。仅允许大小写字母、数字、`@$!%*#_~?&^`，长度为8~16。不允许与旧密码相同。明文传输，请务必确保以https发送；
* 响应体：
```JSON
[
    {
        "status" : "tryChangeSelfAuth",
        "message" : "trying to change the auth of yourself"
    },
    {
        "status" : "nameInvalid",
        "message" : "the format of name is invalid"
    }
]
```
* 响应各参数含义：
  * 当HTTP状态码为`200 OK`时，表示修改成功；当状态码为`401 Unauthorized`时，表示权限不足，即未登录，或非`管理员用户`尝试修改`auth`；当状态码为`409 Conflict`时，表示未发生权限错误，仅发生数据错误，将通过响应体返回所有的错误信息；
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * `message`：信息，作为`status`的扩充信息，更易于阅读；
* 各个错误`status`取值及其含义：
|取值||含义|
|:-|:-|:-|
|`tryChangeSelfAuth`|尝试修改当前用户的权限|
|`nameInvalid`|昵称格式不合法|
|`nameExisted`|昵称已经存在|
|`passwordInvalid`|密码格式不合法|
|`passwordSame`|密码格式不合法|










# 问答相关




##  /api/

* 权限：
* 格式：
```
{BASE_URL}/api/
```
* 类型：
* 请求体：
```JSON
{
}
```
* 请求体各参数含义：
  * 
* 响应体：
```JSON
{
    "status" : "success",
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * 
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
||||





##  /api/question/

* 权限：
* 格式：
```
{BASE_URL}/api/
```
* 类型：
* 请求体：
```JSON
{
}
```
* 请求体各参数含义：
  * 
* 响应体：
```JSON
{
    "status" : "success",
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * 
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
||||









##  /api/

* 权限：
* 格式：
```
{BASE_URL}/api/
```
* 类型：
* 请求体：
```JSON
{
}
```
* 请求体各参数含义：
  * 
* 响应体：
```JSON
{
    "status" : "success",
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * 
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
||||










##  /api/

* 权限：
* 格式：
```
{BASE_URL}/api/
```
* 类型：
* 请求体：
```JSON
{
}
```
* 请求体各参数含义：
  * 
* 响应体：
```JSON
{
    "status" : "success",
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * 
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
||||










##  /api/

* 权限：
* 格式：
```
{BASE_URL}/api/
```
* 类型：
* 请求体：
```JSON
{
}
```
* 请求体各参数含义：
  * 
* 响应体：
```JSON
{
    "status" : "success",
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * 
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
||||










##  /api/

* 权限：
* 格式：
```
{BASE_URL}/api/
```
* 类型：
* 请求体：
```JSON
{
}
```
* 请求体各参数含义：
  * 
* 响应体：
```JSON
{
    "status" : "success",
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * 
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
||||










##  /api/

* 权限：
* 格式：
```
{BASE_URL}/api/
```
* 类型：
* 请求体：
```JSON
{
}
```
* 请求体各参数含义：
  * 
* 响应体：
```JSON
{
    "status" : "success",
}
```
* 响应各参数含义：
  * `status`：字符串，表示处理状态，`success`表示成功，其余表示失败；
  * 
* `status`取值及其含义：
|取值|状态码|含义|
|:-|:-|:-|
|`success`|`200 OK`|成功|
||||
